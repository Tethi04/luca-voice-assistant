<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luca - Voice Assistant</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(90deg, #4A00E0, #8E2DE2);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .main-content {
            padding: 30px;
        }
        
        .voice-section {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
        }
        
        .mic-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4A00E0, #8E2DE2);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .mic-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(74, 0, 224, 0.4);
        }
        
        .mic-btn.listening {
            background: linear-gradient(135deg, #ff416c, #ff4b2b);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .voice-text {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            min-height: 100px;
        }
        
        .chat-box {
            height: 300px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
        }
        
        .message {
            padding: 12px 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            max-width: 80%;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-msg {
            background: #4A00E0;
            color: white;
            margin-left: auto;
        }
        
        .luca-msg {
            background: #e9ecef;
            color: #333;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #4A00E0, #8E2DE2);
            color: white;
            flex: 2;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
            flex: 1;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .quick-commands {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        
        .quick-btn {
            padding: 12px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
            text-align: center;
            transition: all 0.3s;
        }
        
        .quick-btn:hover {
            background: #4A00E0;
            color: white;
            border-color: #4A00E0;
        }
        
        .status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            background: #4CAF50;
            border-radius: 50%;
            animation: blink 2s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            border-top: 1px solid #eee;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ü§ñ Luca - Voice Assistant</h1>
            <p class="subtitle">Say "Luca" followed by your command. Click microphone to speak.</p>
        </header>
        
        <div class="main-content">
            <!-- Voice Input Section -->
            <div class="voice-section">
                <button class="mic-btn" id="micButton" onclick="startListening()">
                    üé§
                </button>
                <textarea 
                    class="voice-text" 
                    id="voiceText" 
                    placeholder="Your speech will appear here... Or type your command manually"
                    onkeypress="handleKeyPress(event)"
                ></textarea>
            </div>
            
            <!-- Controls -->
            <div class="controls">
                <button class="btn btn-primary" onclick="processCommand()">
                    üöÄ Process Command
                </button>
                <button class="btn btn-secondary" onclick="clearChat()">
                    üóëÔ∏è Clear Chat
                </button>
                <button class="btn" onclick="speakResponse()" style="background: #17a2b8; color: white;">
                    üîä Speak Response
                </button>
            </div>
            
            <!-- Chat Display -->
            <div class="chat-box" id="chatBox">
                <div class="message luca-msg">
                    <strong>Luca:</strong> Hello! I'm your voice assistant. Click the microphone üé§ and say "Luca" followed by your command, or type it manually.
                </div>
            </div>
            
            <!-- Quick Commands -->
            <div class="quick-commands">
                <button class="quick-btn" onclick="quickCommand('luca what time is it')">üïí Time</button>
                <button class="quick-btn" onclick="quickCommand('luca what is today date')">üìÖ Date</button>
                <button class="quick-btn" onclick="quickCommand('luca tell me a joke')">üòÇ Joke</button>
                <button class="quick-btn" onclick="quickCommand('luca weather in london')">üå§Ô∏è Weather</button>
                <button class="quick-btn" onclick="quickCommand('luca get news')">üì∞ News</button>
                <button class="quick-btn" onclick="quickCommand('luca open youtube')">üì∫ YouTube</button>
                <button class="quick-btn" onclick="quickCommand('luca search for python')">üîç Search</button>
                <button class="quick-btn" onclick="quickCommand('luca help')">‚ùì Help</button>
            </div>
            
            <!-- Status -->
            <div class="status">
                <div class="status-dot"></div>
                <span id="statusText">Ready to listen. Click üé§ to speak.</span>
            </div>
        </div>
        
        <footer>
            <p>Project 2: Voice Controlled Assistant | Luca ü§ñ | Real-time Voice Processing</p>
            <p>Note: For full voice recognition, allow microphone access.</p>
        </footer>
    </div>

    <script>
        // Speech Recognition
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition = null;
        let isListening = false;
        
        // Text-to-Speech
        const speechSynthesis = window.speechSynthesis;
        
        // Initialize
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';
            
            recognition.onstart = function() {
                isListening = true;
                document.getElementById('micButton').classList.add('listening');
                document.getElementById('statusText').textContent = 'Listening... Speak now!';
            };
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                document.getElementById('voiceText').value = transcript;
                processCommand();
            };
            
            recognition.onend = function() {
                isListening = false;
                document.getElementById('micButton').classList.remove('listening');
                document.getElementById('statusText').textContent = 'Processing complete. Ready for next command.';
            };
            
            recognition.onerror = function(event) {
                console.error('Speech recognition error:', event.error);
                isListening = false;
                document.getElementById('micButton').classList.remove('listening');
                document.getElementById('statusText').textContent = 'Error: ' + event.error;
                addMessage('assistant', 'Sorry, I had trouble hearing you. Please try again or type your command.');
            };
        } else {
            document.getElementById('statusText').textContent = 'Speech recognition not supported. Please type commands.';
        }
        
        // Start listening
        function startListening() {
            if (!recognition) {
                alert('Speech recognition not supported in your browser. Please use Chrome or Edge.');
                return;
            }
            
            if (!isListening) {
                try {
                    recognition.start();
                } catch (e) {
                    console.error('Error starting recognition:', e);
                }
            } else {
                recognition.stop();
            }
        }
        
        // Add message to chat
        function addMessage(sender, text) {
            const chatBox = document.getElementById('chatBox');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender === 'user' ? 'user-msg' : 'luca-msg'}`;
            messageDiv.innerHTML = `<strong>${sender === 'user' ? 'You:' : 'Luca:'}</strong> ${text}`;
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
        
        // Process command
        async function processCommand() {
            const commandInput = document.getElementById('voiceText');
            const command = commandInput.value.trim();
            
            if (!command) {
                addMessage('assistant', 'Please say or type a command.');
                return;
            }
            
            // Add user message
            addMessage('user', command);
            commandInput.value = '';
            
            // Show processing
            document.getElementById('statusText').textContent = 'Processing your command...';
            
            try {
                // Send to backend
                const response = await axios.post('/api/command', {
                    command: command,
                    timestamp: new Date().toISOString()
                });
                
                if (response.data.success) {
                    // Add Luca's response
                    addMessage('assistant', response.data.response);
                    
                    // Speak the response
                    if (response.data.shouldSpeak) {
                        speakText(response.data.response);
                    }
                    
                    // Update status
                    document.getElementById('statusText').textContent = 'Command processed successfully!';
                } else {
                    addMessage('assistant', 'Error: ' + response.data.error);
                }
            } catch (error) {
                console.error('Error:', error);
                
                // Fallback: Process locally if backend fails
                const localResponse = processLocalCommand(command);
                addMessage('assistant', localResponse);
                speakText(localResponse);
                
                document.getElementById('statusText').textContent = 'Using local processing';
            }
        }
        
        // Process command locally (fallback)
        function processLocalCommand(command) {
            command = command.toLowerCase();
            
            // Check if starts with "luca"
            if (!command.includes('luca')) {
                return "Please start your command with 'Luca'";
            }
            
            command = command.replace('luca', '').trim();
            
            // Process different commands
            if (command.includes('time')) {
                const now = new Date();
                return `The time is ${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
            }
            else if (command.includes('date')) {
                const now = new Date();
                return `Today is ${now.toDateString()}`;
            }
            else if (command.includes('joke')) {
                const jokes = [
                    "Why don't scientists trust atoms? Because they make up everything!",
                    "What do you call fake spaghetti? An impasta!",
                    "Why did the scarecrow win an award? He was outstanding in his field!"
                ];
                return jokes[Math.floor(Math.random() * jokes.length)];
            }
            else if (command.includes('weather')) {
                return "Weather information requires API. Try other commands like time, date, or jokes.";
            }
            else if (command.includes('news')) {
                return "News requires API. Try other commands.";
            }
            else if (command.includes('open') && command.includes('youtube')) {
                window.open('https://youtube.com', '_blank');
                return "Opening YouTube...";
            }
            else if (command.includes('search')) {
                const query = command.replace('search', '').replace('for', '').trim();
                if (query) {
                    window.open(`https://google.com/search?q=${encodeURIComponent(query)}`, '_blank');
                    return `Searching for ${query}...`;
                }
                return "What would you like me to search for?";
            }
            else if (command.includes('help')) {
                return `Available commands: 
                - Luca what time is it
                - Luca what is today's date
                - Luca tell me a joke
                - Luca weather in [city]
                - Luca get news
                - Luca open youtube
                - Luca search for [query]
                - Luca help`;
            }
            else {
                return `I heard: "${command}". Try saying "Luca help" for available commands.`;
            }
        }
        
        // Text-to-Speech
        function speakText(text) {
            if ('speechSynthesis' in window) {
                // Clean text (remove emojis, markdown)
                const cleanText = text.replace(/[ü§ñüïíüìÖüòÇüå§Ô∏èüì∞üì∫üîç‚ùì]/g, '').replace(/\*\*/g, '');
                
                const utterance = new SpeechSynthesisUtterance(cleanText);
                utterance.rate = 1.0;
                utterance.pitch = 1.0;
                utterance.volume = 1.0;
                
                // Try to use male voice
                const voices = speechSynthesis.getVoices();
                const maleVoice = voices.find(voice => 
                    voice.name.includes('Male') || 
                    voice.name.includes('Google UK English Male') ||
                    voice.name.includes('Microsoft David')
                );
                
                if (maleVoice) {
                    utterance.voice = maleVoice;
                }
                
                speechSynthesis.speak(utterance);
                
                utterance.onend = function() {
                    console.log('Finished speaking');
                };
            }
        }
        
        function speakResponse() {
            const lastLucaMessage = document.querySelector('.luca-msg:last-child');
            if (lastLucaMessage) {
                const text = lastLucaMessage.textContent.replace('Luca:', '').trim();
                speakText(text);
            }
        }
        
        // Quick command
        function quickCommand(cmd) {
            document.getElementById('voiceText').value = cmd;
            processCommand();
        }
        
        // Clear chat
        function clearChat() {
            document.getElementById('chatBox').innerHTML = 
                '<div class="message luca-msg"><strong>Luca:</strong> Hello! I\'m your voice assistant. Click the microphone üé§ and say "Luca" followed by your command, or type it manually.</div>';
        }
        
        // Handle Enter key
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                processCommand();
            }
        }
        
        // Load voices for TTS
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = function() {
                console.log('Voices loaded');
            };
        }
    </script>
</body>
  </html>
